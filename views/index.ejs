<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>annie&victoria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* é¢„åŠ è½½å­—ä½“ */
        @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url('https://fonts.gstatic.com/s/inter/v12/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2') format('woff2');
        }
        
        /* å…”å­å›¾ç‰‡å›ºå®šå¤§å° */
        .bunny-image {
            width: 90px;
            height: 90px;
            object-fit: cover;
        }
        
        /* å…”å­å®šä½ */
        .bunny {
            position: fixed;
            right: 2rem;
            bottom: 2rem;
            z-index: 50;
        }
        
        /* é¡µè„šäº‘æœµæ ·å¼ */
        .page-footer {
            position: relative;
            height: 150px;
            margin-top: 50px;
        }
        
        .footer-cloud {
            position: absolute;
            left: 20px;
            bottom: 0;
            width: 200px;
            height: auto;
            opacity: 0.8;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #6366f1;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* è®¾ç½®å¼¹çª— */
        .setup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .setup-modal.active {
            display: flex;
        }

        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 9999;
        }

        .toast.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }
    </style>
    <script>
        // é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        victoria: '#3b82f6',
                        annie: '#10b981'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .bunny-talk {
                animation: pop 0.3s ease-out;
            }
            @keyframes pop {
                0% { transform: scale(0.8); opacity: 0; }
                100% { transform: scale(1); opacity: 1; }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen font-sans text-gray-800">
    
    <!-- Toast æç¤º -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- åˆå§‹åŒ–è®¾ç½®å¼¹çª— -->
    <div id="setupModal" class="setup-modal">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ” é…ç½® JSONBin</h2>
            <p class="text-gray-600 mb-6">é¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½® JSONBin.io</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2">API Key (Master Key)</label>
                    <input type="password" id="apiKey" placeholder="$2b$10..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                    <p class="text-xs text-gray-500 mt-1">
                        <a href="https://jsonbin.io/app/api-keys" target="_blank" class="text-primary hover:underline">è·å– API Key â†’</a>
                    </p>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Bin ID</label>
                    <input type="text" id="binId" placeholder="ä¾‹å¦‚ï¼š6580..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                    <p class="text-xs text-gray-500 mt-1">å¦‚æœæ²¡æœ‰ï¼Œç•™ç©ºä¼šè‡ªåŠ¨åˆ›å»º</p>
                </div>
                
                <div class="pt-4 space-y-2">
                    <button onclick="saveConfig()" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition-colors">
                        ä¿å­˜é…ç½®
                    </button>
                    <button onclick="useLocalMode()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                        ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼ˆæ•°æ®ä¸åŒæ­¥ï¼‰
                    </button>
                    <button onclick="forceSync()" class="w-full bg-purple-100 hover:bg-purple-200 text-purple-700 py-3 rounded-lg font-medium transition-colors">
                        å¼ºåˆ¶åŒæ­¥æ•°æ®
                    </button>
                    <button onclick="testCurrentConnection()" class="w-full bg-yellow-100 hover:bg-yellow-200 text-yellow-700 py-3 rounded-lg font-medium transition-colors">
                        æµ‹è¯•å½“å‰è¿æ¥
                    </button>
                    <button onclick="exportConfig()" class="w-full bg-green-100 hover:bg-green-200 text-green-700 py-3 rounded-lg font-medium transition-colors">
                        å¯¼å‡ºé…ç½®
                    </button>
                    <button onclick="importConfig()" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-700 py-3 rounded-lg font-medium transition-colors">
                        å¯¼å…¥é…ç½®
                    </button>
                    <button onclick="clearConfig()" class="w-full bg-red-100 hover:bg-red-200 text-red-700 py-3 rounded-lg font-medium transition-colors">
                        æ¸…é™¤é…ç½®
                    </button>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <h3 class="font-bold text-sm mb-2">ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</h3>
                <ol class="text-xs text-gray-600 space-y-1">
                    <li>1. æ³¨å†Œ <a href="https://jsonbin.io" target="_blank" class="text-primary hover:underline">JSONBin.io</a> è´¦å·</li>
                    <li>2. è·å– API Key (Master Key)</li>
                    <li>3. å¯é€‰ï¼šåˆ›å»ºä¸€ä¸ª Binï¼Œæˆ–ç•™ç©ºè‡ªåŠ¨åˆ›å»º</li>
                    <li>4. ä¿å­˜é…ç½®å³å¯å¼€å§‹ä½¿ç”¨</li>
                </ol>
            </div>
        </div>
    </div>



    <!-- å¯¼èˆªæ  -->
    <nav id="navbar" class="fixed w-full bg-white/90 backdrop-blur-md shadow-sm z-40 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-heart text-primary text-2xl animate-pulse"></i>
                <h1 class="text-xl md:text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    annie&victoria
                </h1>
            </div>
            
            <div class="hidden md:block bg-blue-50 px-4 py-1 rounded-full text-sm font-medium">
                <i class="fa fa-calendar-check-o text-primary mr-1"></i>
                è®¤è¯† <span id="days-count" class="text-primary font-bold">0</span> å¤©å•¦
            </div>
            
            <div class="hidden md:flex space-x-6">
                <a href="#memories" class="hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-camera-retro mr-1"></i> è®°å¿†å¢™
                </a>
                <a href="#diary" class="hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-book mr-1"></i> æ—¥è®°æœ¬
                </a>
                <a href="#todo" class="hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-list mr-1"></i> å¾…åŠæ¸…å•
                </a>
                <a href="#messages" class="hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-envelope mr-1"></i> æ‚„æ‚„è¯
                </a>
                <button onclick="showSettings()" class="text-gray-500 hover:text-primary transition-colors" title="è®¾ç½®">
                    <i class="fa fa-cog"></i>
                </button>
            </div>
            
            <button id="menuBtn" class="md:hidden text-gray-700 hover:text-primary transition-colors">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <div id="mobileMenu" class="md:hidden hidden bg-white border-t">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <div class="py-2 text-center bg-blue-50 rounded-lg">
                    <i class="fa fa-calendar-check-o text-primary mr-1"></i>
                    è®¤è¯† <span id="days-count-mobile" class="text-primary font-bold">0</span> å¤©å•¦
                </div>
                <a href="#memories" class="py-2 hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-camera-retro mr-2 w-6"></i> è®°å¿†å¢™
                </a>
                <a href="#diary" class="py-2 hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-book mr-2 w-6"></i> æ—¥è®°æœ¬
                </a>
                <a href="#todo" class="py-2 hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-list mr-2 w-6"></i> å¾…åŠæ¸…å•
                </a>
                <a href="#messages" class="py-2 hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-envelope mr-2 w-6"></i> æ‚„æ‚„è¯
                </a>
                <button onclick="showSettings()" class="py-2 hover:text-primary transition-colors duration-300 flex items-center">
                    <i class="fa fa-cog mr-2 w-6"></i> è®¾ç½®
                </button>
            </div>
        </div>
    </nav>



    <!-- è‹±é›„åŒºåŸŸ -->
    <header class="pt-24 pb-16 md:pt-32 md:pb-24 px-4 bg-gradient-to-br from-blue-100 via-indigo-50 to-purple-100 relative overflow-hidden">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-bold text-shadow mb-4 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
            æˆ‘ä»¬çš„å°çª
        </h1>
        
        <!-- æ·»åŠ è·³åŠ¨çš„bookå›¾ç‰‡å’Œæ˜Ÿæ˜Ÿ -->
        <div class="my-6 flex justify-center items-center relative">
            <img src="https://x275wang1.github.io/Annie-Victoria/public/images/æ˜Ÿæ˜Ÿ.png" alt="æ˜Ÿæ˜Ÿ" class="absolute w-[550px] h-[550px] object-contain animate-pulse z-0 opacity-60">
            <img src="https://x275wang1.github.io/Annie-Victoria/public/images/book.png" alt="book" class="book-image relative z-10 w-[432px] h-[432px] md:w-[432px] md:h-[432px] object-contain">
        </div>
        
        <p class="text-xl md:text-2xl text-gray-600 mb-2">
            è¯¶ï¼Œä½ ç«Ÿç„¶å‘ç°äº†è¿™ä¸ªç½‘ç«™å‘€ï¼
        </p>
            <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto mb-8">
                è®°å½•æ¯ä¸€ä¸ªæ¬¢ç¬‘çš„ç¬é—´ï¼Œçè—æ¯ä¸€æ®µç¾å¥½çš„å›å¿†ï¼Œ
                è¿™é‡Œæ˜¯å±äº Victoria å’Œ Annie çš„ç§˜å¯†å°çª
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#memories" class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center transform hover:-translate-y-1">
                    <i class="fa fa-image mr-2"></i> æµè§ˆå›å¿†
                </a>
                <a href="#diary" class="bg-white hover:bg-gray-50 text-indigo-600 border-2 border-indigo-200 py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center transform hover:-translate-y-1">
                    <i class="fa fa-pencil mr-2"></i> å†™ç‚¹ä»€ä¹ˆ
                </a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        <!-- è®°å¿†å¢™éƒ¨åˆ† -->
        <section id="memories" class="mb-20">
            <div class="flex items-center mb-8">
                <div class="w-12 h-1 bg-primary rounded-full mr-4"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">æˆ‘ä»¬çš„è®°å¿†å¢™</h2>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold mb-4 text-gray-800">æ·»åŠ æ–°ç…§ç‰‡</h3>
                <form id="memoryForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="lg:col-span-4">
                        <label class="block text-gray-700 mb-2" for="photoFile">é€‰æ‹©ç…§ç‰‡</label>
                        <input type="file" id="photoFile" accept="image/*" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" required>
                        <p class="text-xs text-gray-500 mt-1">å›¾ç‰‡ä¼šè¢«å‹ç¼©ä»¥èŠ‚çœç©ºé—´</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2" for="photoTitle">ç…§ç‰‡æ ‡é¢˜</label>
                        <input type="text" id="photoTitle" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="ä¾‹å¦‚ï¼šä¸€èµ·çœ‹ç”µå½±" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2" for="photoDate">æ—¥æœŸ</label>
                        <input type="date" id="photoDate" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2" for="photoUploader">ä¸Šä¼ äºº</label>
                        <select id="photoUploader" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" required>
                            <option value="Victoria">Victoria</option>
                            <option value="Annie">Annie</option>
                        </select>
                    </div>
                    <div class="lg:col-span-4">
                        <label class="block text-gray-700 mb-2" for="photoDescription">æè¿°</label>
                        <textarea id="photoDescription" rows="2" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="å†™ä¸‹å…³äºè¿™å¼ ç…§ç‰‡çš„å›å¿†..."></textarea>
                    </div>
                    <div class="lg:col-span-4">
                        <button type="submit" class="bg-primary hover:bg-primary/90 text-white py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                            <i class="fa fa-save mr-2"></i> ä¿å­˜ç…§ç‰‡
                        </button>
                    </div>
                </form>
            </div>
            
            <div id="memoriesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        </section>
        
        <!-- æ—¥è®°æœ¬éƒ¨åˆ† -->
        <section id="diary" class="mb-20">
            <div class="flex items-center mb-8">
                <div class="w-12 h-1 bg-secondary rounded-full mr-4"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">æˆ‘ä»¬çš„æ—¥è®°æœ¬</h2>
                <img src="https://x275wang1.github.io/Annie-Victoria/public/images/çœ‹ä¹¦.png" alt="çœ‹ä¹¦" class="ml-4 w-24 h-24 object-contain animate-bounce hover:animate-spin transition-all duration-500 hover:scale-110">
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div id="diariesList" class="lg:col-span-2 space-y-6"></div>
                
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">å†™ç‚¹ä»€ä¹ˆå§</h3>
                    <form id="diaryForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-2" for="diaryTitle">æ ‡é¢˜</label>
                            <input type="text" id="diaryTitle" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="ç»™è¿™ç¯‡æ—¥è®°èµ·ä¸ªæ ‡é¢˜" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2" for="diaryAuthor">ä½œè€…</label>
                            <select id="diaryAuthor" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" required>
                                <option value="Victoria">Victoria</option>
                                <option value="Annie">Annie</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2" for="diaryCategory">åˆ†ç±»</label>
                            <select id="diaryCategory" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                                <option value="æ—¥å¸¸">æ—¥å¸¸</option>
                                <option value="å¿ƒæƒ…">å¿ƒæƒ…</option>
                                <option value="åˆ†äº«">åˆ†äº«</option>
                                <option value="è®¡åˆ’">è®¡åˆ’</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2" for="diaryContent">å†…å®¹</label>
                            <textarea id="diaryContent" rows="5" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="æŠŠæƒ³å¯¹å¥¹è¯´çš„è¯å†™åœ¨è¿™é‡Œ..." required></textarea>
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white py-3 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            <i class="fa fa-pencil mr-2"></i> å‘å¸ƒæ—¥è®°
                        </button>
                    </form>
                </div>
            </div>
        </section>
        
        <!-- å¾…åŠæ¸…å•éƒ¨åˆ† -->
        <section id="todo" class="mb-20">
            <div class="flex items-center mb-8">
                <div class="w-12 h-1 bg-primary rounded-full mr-4"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">æˆ‘ä»¬çš„å¾…åŠæ¸…å•</h2>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                <div class="lg:col-span-3 bg-white rounded-2xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">ä¸€èµ·è¦åšçš„äº‹æƒ…</h3>
                        <div class="flex space-x-2">
                            <button id="showAllTodos" class="bg-blue-100 text-primary text-sm px-3 py-1 rounded-full">å…¨éƒ¨</button>
                            <button id="showActiveTodos" class="bg-gray-100 text-gray-600 text-sm px-3 py-1 rounded-full">æœªå®Œæˆ</button>
                            <button id="showCompletedTodos" class="bg-gray-100 text-gray-600 text-sm px-3 py-1 rounded-full">å·²å®Œæˆ</button>
                        </div>
                    </div>
                    
                    <div id="todosList" class="space-y-4"></div>
                </div>
                
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-md p-6">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">æ·»åŠ æ–°è®¡åˆ’</h3>
                    <form id="todoForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-2" for="todoItem">è®¡åˆ’å†…å®¹</label>
                            <input type="text" id="todoItem" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="ä¾‹å¦‚ï¼šä¸€èµ·å»æ¸¸ä¹å›­" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2" for="todoCreator">åˆ›å»ºäºº</label>
                            <select id="todoCreator" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" required>
                                <option value="Victoria">Victoria</option>
                                <option value="Annie">Annie</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2" for="todoDate">è®¡åˆ’æ—¶é—´</label>
                            <input type="date" id="todoDate" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2" for="todoNotes">å¤‡æ³¨</label>
                            <textarea id="todoNotes" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" placeholder="å†™ä¸‹å…³äºè¿™ä¸ªè®¡åˆ’çš„æƒ³æ³•..."></textarea>
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white py-3 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            <i class="fa fa-plus mr-2"></i> æ·»åŠ åˆ°æ¸…å•
                        </button>
                    </form>
                </div>
            </div>
        </section>
        
        <!-- æ‚„æ‚„è¯éƒ¨åˆ† -->
        <section id="messages" class="mb-12">
            <div class="flex items-center mb-8">
                <div class="w-12 h-1 bg-secondary rounded-full mr-4"></div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">æˆ‘ä»¬çš„æ‚„æ‚„è¯</h2>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div id="messagesContainer" class="h-96 p-6 overflow-y-auto space-y-6"></div>
                
                <div class="border-t p-4">
                    <form id="messageForm" class="flex">
                        <select id="messageSender" class="w-24 p-3 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="Victoria">Victoria</option>
                            <option value="Annie">Annie</option>
                        </select>
                        <input type="text" id="messageInput" class="flex-grow p-3 border-t border-b border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="è¾“å…¥æƒ³å¯¹å¥¹è¯´çš„è¯..." required>
                        <button type="submit" class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white px-6 rounded-r-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            <i class="fa fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-white py-8 border-t">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center items-center mb-4">
                <i class="fa fa-heart text-primary text-2xl mr-2 animate-pulse"></i>
                <h2 class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">annie&victoria</h2>
            </div>
            <p class="text-gray-500 mb-6">è®°å½•æ¯ä¸€ä¸ªçè´µç¬é—´ï¼Œåˆ›é€ æ›´å¤šç¾å¥½å›å¿†</p>
            <p class="text-gray-400 text-sm">Â© 2024 Victoria & Annie çš„å°çª</p>
        </div>
    </footer>

    <!-- é¡µé¢åº•éƒ¨ç´ æ -->
    <div class="page-footer">
        <img src="https://x275wang1.github.io/Annie-Victoria/public/images/cloud.png" alt="å¯çˆ±äº‘æœµå’Œæ˜Ÿæ˜Ÿ" class="footer-cloud" />
        <!-- ä¼šè¯´è¯çš„å…”å­ -->
        <div id="bunny" class="bunny">
            <div class="relative">
                <img src="https://x275wang1.github.io/Annie-Victoria/public/images/penny.png" alt="å¯çˆ±çš„å°å…”å­" class="bunny-image rounded-full border-4 border-blue-200">
                <div id="bunny-speech" class="hidden absolute -top-24 -left-48 bg-white rounded-2xl p-3 shadow-lg border-2 border-blue-200 bunny-talk max-w-[180px]">
                    <p id="bunny-text" class="text-sm">ä½ ä»¬å¥½å‘€ï¼ğŸ˜Š</p>
                    <div class="absolute -bottom-3 left-10 w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-white"></div>
                    <div class="absolute -bottom-5 left-10 w-0 h-0 border-l-10 border-r-10 border-t-10 border-l-transparent border-r-transparent border-t-blue-200"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JSONBin.io é…ç½®ç®¡ç†
        class JSONBinStorage {
            constructor() {
                this.loadConfig();
            }

            loadConfig() {
                const saved = localStorage.getItem('jsonbin_config');
                if (saved) {
                    const config = JSON.parse(saved);
                    this.apiKey = config.apiKey;
                    this.binId = config.binId;
                    this.isLocal = config.isLocal || false;
                } else {
                    this.isLocal = true; // é»˜è®¤ä½¿ç”¨æœ¬åœ°æ¨¡å¼
                }
            }

            saveConfig(apiKey, binId) {
                const config = { apiKey, binId, isLocal: false };
                localStorage.setItem('jsonbin_config', JSON.stringify(config));
                this.apiKey = apiKey;
                this.binId = binId;
                this.isLocal = false;
            }

            setLocalMode() {
                const config = { isLocal: true };
                localStorage.setItem('jsonbin_config', JSON.stringify(config));
                this.isLocal = true;
            }

            async createBin(initialData) {
                if (!this.apiKey) throw new Error('API Key required');
                
                const response = await fetch('https://api.jsonbin.io/v3/b', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': this.apiKey,
                        'X-Bin-Name': 'annie-victoria-data',
                        'X-Bin-Private': 'false'
                    },
                    body: JSON.stringify(initialData)
                });

                if (!response.ok) throw new Error('Failed to create bin');
                
                const data = await response.json();
                return data.metadata.id;
            }

            async loadData() {
                if (this.isLocal) {
                    return this.loadLocalData();
                }

                if (!this.apiKey || !this.binId) {
                    throw new Error('Configuration required');
                }

                try {
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${this.binId}/latest`, {
                        headers: {
                            'X-Master-Key': this.apiKey
                        }
                    });

                    if (!response.ok) throw new Error('Failed to load data');
                    
                    const data = await response.json();
                    return data.record;
                } catch (error) {
                    console.error('Error loading from JSONBin:', error);
                    // å›é€€åˆ°æœ¬åœ°æ•°æ®
                    return this.loadLocalData();
                }
            }

            async saveData(data) {
                if (this.isLocal) {
                    return this.saveLocalData(data);
                }

                if (!this.apiKey || !this.binId) {
                    throw new Error('Configuration required');
                }

                try {
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${this.binId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': this.apiKey
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) throw new Error('Failed to save data');
                    
                    // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºå¤‡ä»½
                    this.saveLocalData(data);
                    
                    return true;
                } catch (error) {
                    console.error('Error saving to JSONBin:', error);
                    // ä¿å­˜åˆ°æœ¬åœ°
                    return this.saveLocalData(data);
                }
            }

            loadLocalData() {
                const data = localStorage.getItem('app_data');
                return data ? JSON.parse(data) : {
                    memories: [],
                    diaries: [],
                    todos: [],
                    messages: []
                };
            }

            saveLocalData(data) {
                localStorage.setItem('app_data', JSON.stringify(data));
                return true;
            }
        }

        // åˆå§‹åŒ–å­˜å‚¨
        const storage = new JSONBinStorage();
        let appData = {
            memories: [],
            diaries: [],
            todos: [],
            messages: []
        };

        // å‹ç¼©å›¾ç‰‡
        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        if (width > maxWidth) {
                            height = (maxWidth / width) * height;
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        canvas.toBlob((blob) => {
                            const reader = new FileReader();
                            reader.onloadend = () => resolve(reader.result);
                            reader.readAsDataURL(blob);
                        }, 'image/jpeg', quality);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `toast show ${type}`;
            toastMessage.textContent = message;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ä¿å­˜é…ç½®
        async function saveConfig() {
            const apiKey = document.getElementById('apiKey').value.trim();
            let binId = document.getElementById('binId').value.trim();
            
            if (!apiKey) {
                showToast('è¯·è¾“å…¥ API Key', 'error');
                return;
            }
            
            try {
                // å¦‚æœæ²¡æœ‰æä¾› Bin IDï¼Œåˆ›å»ºæ–°çš„
                if (!binId) {
                    showToast('æ­£åœ¨åˆ›å»ºå­˜å‚¨ç©ºé—´...', 'success');
                    storage.apiKey = apiKey; // ä¸´æ—¶è®¾ç½®ç”¨äºåˆ›å»º
                    binId = await storage.createBin(appData);
                    showToast('å­˜å‚¨ç©ºé—´åˆ›å»ºæˆåŠŸï¼', 'success');
                }
                
                // å…ˆæµ‹è¯•è¿æ¥
                showToast('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'success');
                const testResult = await testConnection(apiKey, binId);
                if (!testResult.success) {
                    showToast('è¿æ¥æµ‹è¯•å¤±è´¥ï¼š' + testResult.error, 'error');
                    return;
                }
                showToast('è¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
                
                storage.saveConfig(apiKey, binId);
                document.getElementById('setupModal').classList.remove('active');
                
                // å¼ºåˆ¶é‡æ–°åŠ è½½æ•°æ®
                await loadAllData();
                showToast('é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                
                // åˆ·æ–°é¡µé¢ä»¥ç¡®ä¿é…ç½®ç”Ÿæ•ˆ
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                showToast('é…ç½®å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æµ‹è¯•è¿æ¥
        async function testConnection(apiKey, binId) {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                    headers: {
                        'X-Master-Key': apiKey
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        return { success: false, error: 'API Key æ— æ•ˆæˆ–æƒé™ä¸è¶³' };
                    } else if (response.status === 404) {
                        return { success: false, error: 'Bin ID ä¸å­˜åœ¨' };
                    } else {
                        return { success: false, error: `HTTPé”™è¯¯: ${response.status}` };
                    }
                }
                
                const data = await response.json();
                return { success: true, data: data.record };
            } catch (error) {
                return { success: false, error: 'ç½‘ç»œè¿æ¥å¤±è´¥: ' + error.message };
            }
        }

        // å¼ºåˆ¶åŒæ­¥æ•°æ®
        async function forceSync() {
            try {
                showToast('æ­£åœ¨å¼ºåˆ¶åŒæ­¥æ•°æ®...', 'success');
                
                // æ¸…é™¤æœ¬åœ°ç¼“å­˜
                localStorage.removeItem('app_data');
                
                // é‡æ–°åŠ è½½æ•°æ®
                await loadAllData();
                
                showToast('æ•°æ®åŒæ­¥å®Œæˆï¼', 'success');
                
                // åˆ·æ–°é¡µé¢æ˜¾ç¤º
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                showToast('åŒæ­¥å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æµ‹è¯•å½“å‰è¿æ¥
        async function testCurrentConnection() {
            try {
                showToast('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'success');
                
                if (storage.isLocal) {
                    showToast('å½“å‰ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼Œæ— éœ€æµ‹è¯•è¿æ¥', 'info');
                    return;
                }
                
                if (!storage.apiKey || !storage.binId) {
                    showToast('è¯·å…ˆé…ç½®API Keyå’ŒBin ID', 'error');
                    return;
                }
                
                const result = await testConnection(storage.apiKey, storage.binId);
                if (result.success) {
                    showToast(`è¿æ¥æˆåŠŸï¼æ‰¾åˆ° ${Object.keys(result.data).length} ä¸ªæ•°æ®é¡¹`, 'success');
                    console.log('è¿æ¥æµ‹è¯•æˆåŠŸï¼Œæ•°æ®:', result.data);
                } else {
                    showToast('è¿æ¥å¤±è´¥ï¼š' + result.error, 'error');
                    console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('æµ‹è¯•è¿æ¥å¤±è´¥:', error);
                showToast('æµ‹è¯•å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // ä½¿ç”¨æœ¬åœ°æ¨¡å¼
        function useLocalMode() {
            storage.setLocalMode();
            document.getElementById('setupModal').classList.remove('active');
            loadAllData();
            showToast('å·²åˆ‡æ¢åˆ°æœ¬åœ°æ¨¡å¼', 'success');
        }

        // æ¸…é™¤é…ç½®
        function clearConfig() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰é…ç½®å—ï¼Ÿè¿™å°†åˆ é™¤API Keyå’ŒBin IDã€‚')) {
                localStorage.removeItem('jsonbin_config');
                localStorage.removeItem('app_data');
                storage.loadConfig();
                document.getElementById('setupModal').classList.remove('active');
                showToast('é…ç½®å·²æ¸…é™¤ï¼Œè¯·é‡æ–°é…ç½®', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            const config = localStorage.getItem('jsonbin_config');
            if (!config) {
                showToast('æ²¡æœ‰æ‰¾åˆ°é…ç½®ä¿¡æ¯', 'error');
                return;
            }
            
            try {
                const configData = JSON.parse(config);
                const exportData = {
                    apiKey: configData.apiKey,
                    binId: configData.binId,
                    exportDate: new Date().toISOString(),
                    note: 'Victoria & Annie ç½‘ç«™é…ç½®ä¿¡æ¯'
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'annie-victoria-config.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('é…ç½®å·²å¯¼å‡ºåˆ°æ–‡ä»¶', 'success');
            } catch (error) {
                showToast('å¯¼å‡ºå¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // å¯¼å…¥é…ç½®
        function importConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const configData = JSON.parse(e.target.result);
                        
                        if (configData.apiKey && configData.binId) {
                            document.getElementById('apiKey').value = configData.apiKey;
                            document.getElementById('binId').value = configData.binId;
                            
                            showToast('é…ç½®å¯¼å…¥æˆåŠŸï¼è¯·ç‚¹å‡»ä¿å­˜é…ç½®', 'success');
                        } else {
                            showToast('é…ç½®æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'error');
                        }
                    } catch (error) {
                        showToast('å¯¼å…¥å¤±è´¥ï¼š' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // æ˜¾ç¤ºè®¾ç½®
        function showSettings() {
            const config = localStorage.getItem('jsonbin_config');
            if (config) {
                const parsed = JSON.parse(config);
                document.getElementById('apiKey').value = parsed.apiKey || '';
                document.getElementById('binId').value = parsed.binId || '';
            }
            document.getElementById('setupModal').classList.add('active');
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadAllData() {
            try {
                appData = await storage.loadData();
                renderMemories();
                renderDiaries();
                renderTodos();
                renderMessages();
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('åŠ è½½æ•°æ®å¤±è´¥', 'error');
            }
        }

        // ä¿å­˜æ‰€æœ‰æ•°æ®
        async function saveAllData() {
            try {
                await storage.saveData(appData);
                showToast('æ•°æ®ä¿å­˜æˆåŠŸ', 'success');
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('ä¿å­˜å¤±è´¥ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'error');
            }
        }

        // æ¸²æŸ“è®°å¿†å¢™
        function renderMemories() {
            const grid = document.getElementById('memoriesGrid');
            
            if (appData.memories.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12 bg-white rounded-xl shadow-sm">
                        <i class="fa fa-camera text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">è¿˜æ²¡æœ‰ç…§ç‰‡å‘¢ï¼Œä¸Šä¼ ç¬¬ä¸€å¼ å›å¿†å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = appData.memories.map(memory => `
                <div class="bg-white rounded-2xl shadow-md overflow-hidden card-hover group relative">
                    <button onclick="deleteMemory('${memory.id}')" class="absolute top-2 right-2 z-10 bg-white/80 hover:bg-white text-gray-500 hover:text-red-500 p-1 rounded-full shadow-md transition-colors">
                        <i class="fa fa-trash-o"></i>
                    </button>
                    <div class="relative overflow-hidden">
                        <img src="${memory.photo}" alt="${memory.title}" class="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-110">
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                            <p class="text-white font-medium">${memory.title}</p>
                            <p class="text-white/80 text-sm">${memory.date} Â· ç”± ${memory.uploader} ä¸Šä¼ </p>
                        </div>
                    </div>
                    <div class="p-4">
                        <p class="text-gray-600">${memory.desc || ''}</p>
                        <div class="mt-3 text-xs text-gray-400">${new Date(memory.timestamp).toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æ—¥è®°
        function renderDiaries() {
            const list = document.getElementById('diariesList');
            
            if (appData.diaries.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-12 bg-white rounded-xl shadow-sm">
                        <i class="fa fa-book text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">æ—¥è®°æœ¬è¿˜æ˜¯ç©ºçš„ï¼Œå†™ä¸‹ç¬¬ä¸€ç¯‡æ—¥è®°å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = appData.diaries.map(diary => `
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold ${diary.author === 'Victoria' ? 'text-victoria' : 'text-annie'}">${diary.title}</h3>
                            <p class="text-gray-500 text-sm">${new Date(diary.timestamp).toLocaleString()} Â· ç”± ${diary.author} å‘å¸ƒ</p>
                        </div>
                        <span class="bg-blue-50 text-primary text-xs px-3 py-1 rounded-full">${diary.category}</span>
                    </div>
                    <p class="text-gray-600 mb-4">${diary.content}</p>
                    <button onclick="deleteDiary('${diary.id}')" class="text-gray-400 hover:text-red-500 text-sm">
                        <i class="fa fa-trash-o mr-1"></i> åˆ é™¤
                    </button>
                </div>
            `).join('');
        }

        // æ¸²æŸ“å¾…åŠäº‹é¡¹
        let currentTodoFilter = 'all';
        
        function renderTodos() {
            const list = document.getElementById('todosList');
            let todos = [...appData.todos];
            
            if (currentTodoFilter === 'active') {
                todos = todos.filter(todo => !todo.completed);
            } else if (currentTodoFilter === 'completed') {
                todos = todos.filter(todo => todo.completed);
            }
            
            if (todos.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fa fa-list text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">è¿˜æ²¡æœ‰è®¡åˆ’å‘¢ï¼Œæ·»åŠ ä¸€ä¸ªä¸€èµ·å®Œæˆçš„äº‹æƒ…å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = todos.map(todo => `
                <div class="flex items-center p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors duration-200 ${todo.completed ? 'bg-gray-50' : ''}">
                    <input type="checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo('${todo.id}')" class="w-5 h-5 text-primary rounded focus:ring-primary mr-3">
                    <div class="flex-grow">
                        <span class="${todo.completed ? 'line-through text-gray-500' : ''}">${todo.task}</span>
                        <div class="flex items-center mt-1 text-sm">
                            <span class="text-gray-500 mr-3"><i class="fa fa-calendar-o mr-1"></i> ${todo.deadline}</span>
                            <span class="text-gray-400"><i class="fa fa-user-o mr-1"></i> ${todo.creator}</span>
                        </div>
                        ${todo.notes ? `<p class="text-xs text-gray-500 mt-1">${todo.notes}</p>` : ''}
                    </div>
                    <button onclick="deleteTodo('${todo.id}')" class="text-gray-400 hover:text-red-500 ml-2">
                        <i class="fa fa-trash-o"></i>
                    </button>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æ¶ˆæ¯
        function renderMessages() {
            const container = document.getElementById('messagesContainer');
            
            if (appData.messages.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-16">
                        <i class="fa fa-envelope text-gray-300 text-5xl mb-4"></i>
                        <p class="text-gray-500">è¿˜æ²¡æœ‰æ‚„æ‚„è¯å‘¢ï¼Œç»™å¯¹æ–¹å‘ä¸€æ¡å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = appData.messages.map(message => `
                <div class="flex items-start ${message.sender === 'Victoria' ? 'justify-end' : ''}">
                    ${message.sender === 'Annie' ? `
                        <div class="w-10 h-10 rounded-full bg-annie/20 flex items-center justify-center mr-3 flex-shrink-0">
                            <span class="font-bold text-annie">A</span>
                        </div>
                    ` : ''}
                    <div class="max-w-[70%]">
                        <div class="${message.sender === 'Victoria' ? 'bg-victoria/10 rounded-2xl rounded-tr-none' : 'bg-annie/10 rounded-2xl rounded-tl-none'} p-4">
                            <p>${message.message}</p>
                        </div>
                        <p class="text-gray-400 text-xs mt-1 ${message.sender === 'Victoria' ? 'text-right' : 'ml-2'}">
                            ${message.sender} Â· ${new Date(message.timestamp).toLocaleString()}
                        </p>
                    </div>
                    ${message.sender === 'Victoria' ? `
                        <div class="w-10 h-10 rounded-full bg-victoria/20 flex items-center justify-center ml-3 flex-shrink-0">
                            <span class="font-bold text-victoria">V</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            container.scrollTop = container.scrollHeight;
        }

        // åˆ é™¤åŠŸèƒ½
        async function deleteMemory(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ')) {
                appData.memories = appData.memories.filter(m => m.id !== id);
                await saveAllData();
                renderMemories();
            }
        }

        async function deleteDiary(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ')) {
                appData.diaries = appData.diaries.filter(d => d.id !== id);
                await saveAllData();
                renderDiaries();
            }
        }

        async function deleteTodo(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¾…åŠäº‹é¡¹å—ï¼Ÿ')) {
                appData.todos = appData.todos.filter(t => t.id !== id);
                await saveAllData();
                renderTodos();
            }
        }

        // åˆ‡æ¢å¾…åŠçŠ¶æ€
        async function toggleTodo(id) {
            const todo = appData.todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                await saveAllData();
                renderTodos();
            }
        }

        // å¾…åŠç­›é€‰
        document.getElementById('showAllTodos').addEventListener('click', function() {
            currentTodoFilter = 'all';
            setActiveFilter(this);
            renderTodos();
        });

        document.getElementById('showActiveTodos').addEventListener('click', function() {
            currentTodoFilter = 'active';
            setActiveFilter(this);
            renderTodos();
        });

        document.getElementById('showCompletedTodos').addEventListener('click', function() {
            currentTodoFilter = 'completed';
            setActiveFilter(this);
            renderTodos();
        });

        function setActiveFilter(button) {
            document.querySelectorAll('#showAllTodos, #showActiveTodos, #showCompletedTodos').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-primary');
                btn.classList.add('bg-gray-100', 'text-gray-600');
            });
            button.classList.remove('bg-gray-100', 'text-gray-600');
            button.classList.add('bg-blue-100', 'text-primary');
        }

        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('memoryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('photoFile');
            const file = fileInput.files[0];
            
            if (file) {
                showToast('æ­£åœ¨å¤„ç†å›¾ç‰‡...', 'success');
                const compressedImage = await compressImage(file);
                
                const memory = {
                    id: Date.now().toString(),
                    title: document.getElementById('photoTitle').value,
                    date: document.getElementById('photoDate').value,
                    desc: document.getElementById('photoDescription').value,
                    photo: compressedImage,
                    uploader: document.getElementById('photoUploader').value,
                    timestamp: new Date().toISOString()
                };
                
                appData.memories.unshift(memory);
                await saveAllData();
                renderMemories();
                this.reset();
            }
        });

        document.getElementById('diaryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const diary = {
                id: Date.now().toString(),
                title: document.getElementById('diaryTitle').value,
                author: document.getElementById('diaryAuthor').value,
                category: document.getElementById('diaryCategory').value,
                content: document.getElementById('diaryContent').value,
                timestamp: new Date().toISOString()
            };
            
            appData.diaries.unshift(diary);
            await saveAllData();
            renderDiaries();
            this.reset();
        });

        document.getElementById('todoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const todo = {
                id: Date.now().toString(),
                task: document.getElementById('todoItem').value,
                creator: document.getElementById('todoCreator').value,
                deadline: document.getElementById('todoDate').value,
                notes: document.getElementById('todoNotes').value,
                completed: false,
                timestamp: new Date().toISOString()
            };
            
            appData.todos.unshift(todo);
            await saveAllData();
            renderTodos();
            this.reset();
        });

        document.getElementById('messageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const message = {
                id: Date.now().toString(),
                sender: document.getElementById('messageSender').value,
                message: document.getElementById('messageInput').value,
                timestamp: new Date().toISOString()
            };
            
            appData.messages.push(message);
            await saveAllData();
            renderMessages();
            document.getElementById('messageInput').value = '';
        });

        // è®¡ç®—ç›¸è¯†å¤©æ•°
        function calculateDays() {
            const startDate = new Date('2021-04-01');
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('days-count').textContent = diffDays;
            if (document.getElementById('days-count-mobile')) {
                document.getElementById('days-count-mobile').textContent = diffDays;
            }
        }

        // å…”å­å¯¹è¯åŠŸèƒ½
        const bunny = document.getElementById('bunny');
        const bunnySpeech = document.getElementById('bunny-speech');
        const bunnyText = document.getElementById('bunny-text');
        
        const bunnyPhrases = [
            "ä½ ä»¬å¥½å‘€ï¼ğŸ˜Š",
            "ä»Šå¤©ä¹Ÿæ˜¯å¼€å¿ƒçš„ä¸€å¤©å‘¢ï¼",
            "å¥½ç¾¡æ…•ä½ ä»¬çš„å‹è°Šå‘€ï½",
            "è¦ä¸€ç›´è¿™ä¹ˆå¥½å“¦ï¼",
            "è®°å¾—å¤šæ‹ç…§è®°å½•ç¾å¥½ç¬é—´å‘€ï¼",
            "ä»Šå¤©æœ‰æ²¡æœ‰ä»€ä¹ˆå¼€å¿ƒçš„äº‹å‘€ï¼Ÿ",
            "åŠ æ²¹å®Œæˆå¾…åŠæ¸…å•å§ï¼",
            "æ‚„æ‚„è¯æ—¶é—´åˆ°ï½"
        ];
        
        bunny.addEventListener('mouseenter', () => {
            const randomPhrase = bunnyPhrases[Math.floor(Math.random() * bunnyPhrases.length)];
            bunnyText.textContent = randomPhrase;
            bunnySpeech.classList.remove('hidden');
        });
        
        bunny.addEventListener('mouseleave', () => {
            bunnySpeech.classList.add('hidden');
        });

        // ç§»åŠ¨ç«¯èœå•
        const menuBtn = document.getElementById('menuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        
        menuBtn.addEventListener('click', function() {
            mobileMenu.classList.toggle('hidden');
            if (mobileMenu.classList.contains('hidden')) {
                menuBtn.innerHTML = '<i class="fa fa-bars text-xl"></i>';
            } else {
                menuBtn.innerHTML = '<i class="fa fa-times text-xl"></i>';
            }
        });

        // å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                if (!mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                    menuBtn.innerHTML = '<i class="fa fa-bars text-xl"></i>';
                }
                
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // åˆå§‹åŒ–
        calculateDays();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºè®¾ç½®
        const config = localStorage.getItem('jsonbin_config');
        if (!config) {
            document.getElementById('setupModal').classList.add('active');
        } else {
            loadAllData();
        }
    </script>
</body>
</html>